# LayoutBuilderã€AfterLayout

## LayoutBuilder
å¸ƒå±€æ„å»ºå™¨ã€‚

å¯ä»¥åœ¨å¸ƒå±€è¿‡ç¨‹ä¸­æ‹¿åˆ°çˆ¶ç»„ä»¶ä¼ é€’çš„çº¦æŸä¿¡æ¯ï¼Œå†æ ¹æ®çº¦æŸä¿¡æ¯åŠ¨æ€çš„æ„å»ºä¸åŒçš„å¸ƒå±€ã€‚

### ç¤ºä¾‹
å®ç°ä¸€ä¸ªå“åº”å¼çš„ Column ç»„ä»¶ ResponsiveColumnã€‚

å½“å½“å‰å¯ç”¨çš„å®½åº¦å°äº 200 æ—¶ï¼Œå°†å­ç»„ä»¶æ˜¾ç¤ºä¸ºä¸€åˆ—ï¼Œå¦åˆ™æ˜¾ç¤ºä¸ºä¸¤åˆ—ã€‚

[è¿è¡Œä»£ç ](code/LayoutBuilder.dart)

å®ƒéå¸¸å®ç”¨ä¸”é‡è¦ï¼Œå®ƒä¸»è¦æœ‰ä¸¤ä¸ªä½¿ç”¨åœºæ™¯ï¼š
1. å¯ä»¥ä½¿ç”¨ LayoutBuilder æ¥æ ¹æ®è®¾å¤‡çš„å°ºå¯¸æ¥å®ç°å“åº”å¼å¸ƒå±€ã€‚
2. LayoutBuilder å¯ä»¥å¸®æˆ‘ä»¬é«˜æ•ˆæ’æŸ¥é—®é¢˜ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨é‡åˆ°å¸ƒå±€é—®é¢˜æˆ–è€…æƒ³è°ƒè¯•ç»„ä»¶æ ‘ä¸­æŸä¸€ä¸ªèŠ‚ç‚¹å¸ƒå±€çš„çº¦æŸæ—¶ LayoutBuilder å°±å¾ˆæœ‰ç”¨ã€‚

### æ‰“å°å¸ƒå±€æ—¶çš„çº¦æŸä¿¡æ¯
``` dart
class LayoutLogPrint<T> extends StatelessWidget {
  const LayoutLogPrint({
    Key? key,
    this.tag,
    required this.child,
  }) : super(key: key);

  final Widget child;
  final T? tag; //æŒ‡å®šæ—¥å¿—tag

  @override
  Widget build(BuildContext context) {
    return LayoutBuilder(builder: (_, constraints) {
      // assertåœ¨ç¼–è¯‘releaseç‰ˆæœ¬æ—¶ä¼šè¢«å»é™¤
      assert(() {
        print('${tag ?? key ?? child}: $constraints');
        return true;
      }());
      return child;
    });
  }
}
```

å¯ä»¥ä½¿ç”¨ LayoutLogPrint ç»„ä»¶æ ‘ä¸­ä»»æ„ä½ç½®çš„çº¦æŸä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š

``` dart
LayoutLogPrint(child:Text("xx"))
```

æ§åˆ¶å°è¾“å‡ºï¼š
``` dart
// å¯ä»¥çœ‹åˆ° Text("xx") çš„æ˜¾ç¤ºç©ºé—´æœ€å¤§å®½åº¦ä¸º 428ï¼Œæœ€å¤§é«˜åº¦ä¸º 823 ã€‚
flutter: Text("xx"): BoxConstraints(0.0<=w<=428.0, 0.0<=h<=823.0)
```

> ğŸ’¡ å¦‚æœæ˜¯Sliver å¸ƒå±€ï¼Œè¦ä½¿ç”¨ SliverLayoutBuilder æ¥æ‰“å°ã€‚

***

## AfterLayout

### å“åº”å¼UIæ¡†æ¶
å¼€å‘è€…åªéœ€è¦å…³æ³¨æ•°æ®çš„å˜åŒ–ï¼Œæ•°æ®å˜åŒ–åæ¡†æ¶ä¼šè‡ªåŠ¨é‡æ–°æ„å»ºUIï¼Œä¸éœ€è¦å¼€å‘è€…æ‰‹åŠ¨å»æ“ä½œæ¯ä¸€ä¸ªç»„ä»¶ã€‚

ä½†ç¼ºç‚¹æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®ç»„ä»¶æ¥è·å–å…¶ä¿¡æ¯ã€‚

### è·å–ç»„ä»¶çš„å®½é«˜å’Œåæ ‡ä¿¡æ¯
AfterLayout ç»„ä»¶ï¼Œå®ƒå¯ä»¥åœ¨å­ç»„ä»¶å¸ƒå±€å®Œæˆåæ‰§è¡Œä¸€ä¸ªå›è°ƒï¼Œå¹¶åŒæ—¶å°† RenderObject å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ã€‚
``` dart
AfterLayout(
  callback: (RenderAfterLayout ral) {
    print(ral.size); //å­ç»„ä»¶çš„å¤§å°
    print(ral.offset);// å­ç»„ä»¶åœ¨å±å¹•ä¸­åæ ‡
  },
  child: Text('flutter@wendux'),
),
```
è¿™æ®µä»£ç å¦‚æœç­‰åŒäºä¸€ä¸‹è¿™æ®µå®‰å“ä¼ªä»£ç 
``` kotlin
tv.setText("flutter@wendux");
tv.setAfterLayoutListener{ ral: RenderAfterLayout ->
    println(ral.size); //å­ç»„ä»¶çš„å¤§å°
    println(ral.offset);// å­ç»„ä»¶åœ¨å±å¹•ä¸­åæ ‡
}
```
æ§åˆ¶å°è¾“å‡º
``` dart
flutter: Size(105.0, 17.0)
flutter: Offset(42.5, 290.0)
```

### è·å–ç»„ä»¶ç›¸å¯¹äºæŸä¸ªçˆ¶ç»„ä»¶çš„åæ ‡
``` dart
Builder(builder: (context) {
  return Container(
    color: Colors.grey.shade200,
    alignment: Alignment.center,
    width: 100,
    height: 100,
    child: AfterLayout(
      /// RenderAfterLayout ç±»ç»§æ‰¿è‡ª RenderBox
      callback: (RenderAfterLayout ral) {
        /// localToGlobalå¯ä»¥å°†åæ ‡è½¬åŒ–ä¸ºç›¸å¯¹ä¸æŒ‡å®šçš„ç¥–å…ˆèŠ‚ç‚¹çš„åæ ‡
        Offset offset = ral.localToGlobal(
          Offset.zero,
          // ä¼ ä¸€ä¸ªçˆ¶çº§å…ƒç´ 
          ancestor: context.findRenderObject(),
        );
        print('A åœ¨ Container ä¸­å ç”¨çš„ç©ºé—´èŒƒå›´ä¸ºï¼š${offset & ral.size}');
      },
      child: Text('A'),
    ),
  );
}),
```

***

## Flutter çš„ build å’Œ layout
Flutter çš„build å’Œ layout æ˜¯å¯ä»¥äº¤é”™æ‰§è¡Œçš„ï¼Œå¹¶ä¸æ˜¯ä¸¥æ ¼çš„æŒ‰ç…§å…ˆ build å† layout çš„é¡ºåºã€‚




